# テスト設計: タイムゾーン変換

## テスト対象
- `services/timezone_utils.py`: `utc_to_local()` 関数
- `cli.py`: 時刻表示のローカル変換

---

## 1. utc_to_local() 関数テストケース

### 1.1 基本変換テスト

| ID | テストケース | 入力 | 期待結果 |
|----|-------------|------|----------|
| TZ-001 | UTC datetime変換 | `datetime(2024,1,1,0,0,0,tzinfo=UTC)` | ローカルタイムゾーンのdatetime |
| TZ-002 | naive datetime変換 | `datetime(2024,1,1,0,0,0)` | UTCとして扱いローカルに変換 |
| TZ-003 | 既にローカルのdatetime | ローカルTZのdatetime | そのまま返す |

### 1.2 タイムゾーン情報テスト

| ID | テストケース | 入力 | 期待結果 |
|----|-------------|------|----------|
| TZ-010 | 結果にタイムゾーン情報あり | 任意のdatetime | `tzinfo` が None でない |
| TZ-011 | ローカルタイムゾーン一致 | 任意のdatetime | システムのローカルTZと一致 |

### 1.3 時刻の正確性テスト

| ID | テストケース | 入力 | 期待結果 |
|----|-------------|------|----------|
| TZ-020 | UTC+9(JST)環境 | `2024-01-01 00:00:00 UTC` | `2024-01-01 09:00:00 JST` |
| TZ-021 | 日付変更を伴う変換 | `2024-01-01 20:00:00 UTC` (JST+9) | `2024-01-02 05:00:00 JST` |

### 1.4 エッジケース

| ID | テストケース | 入力 | 期待結果 |
|----|-------------|------|----------|
| TZ-030 | 年越し時刻 | `2023-12-31 23:00:00 UTC` | 正しいローカル年に変換 |
| TZ-031 | うるう年2/29 | `2024-02-29 12:00:00 UTC` | 正しく変換 |
| TZ-032 | 最小datetime | `datetime.min` + tzinfo | エラーなく変換 |

---

## 2. format_local_time() 関数テストケース

### 2.1 フォーマットテスト

| ID | テストケース | 入力 | 期待結果 |
|----|-------------|------|----------|
| FT-001 | 時刻フォーマット | datetime | "HH:MM:SS" 形式の文字列 |
| FT-002 | ゼロパディング | 午前1時 | "01:00:00" |

---

## 3. CLI表示テスト

### 3.1 StatusEntry表示

| ID | テストケース | 入力 | 期待結果 |
|----|-------------|------|----------|
| CLI-001 | テーブルの時刻表示 | UTC timestamp | ローカル時刻で表示 |

---

## 4. テスト実装ファイル

| ファイル | 内容 |
|---------|------|
| `tests/test_timezone_utils.py` | タイムゾーン変換のユニットテスト |

---

## 5. モック戦略

タイムゾーン変換のテストでは、システムのローカルタイムゾーンに依存するため：

```python
import os
from unittest.mock import patch

# テスト中は特定のタイムゾーンを設定
@pytest.fixture
def jst_timezone():
    with patch.dict(os.environ, {"TZ": "Asia/Tokyo"}):
        import time
        time.tzset()
        yield
```

ただし、Pythonの`astimezone()`はシステムのタイムゾーンを自動検出するため、
テストでは相対的な変換（UTCオフセットの確認）を行う。

---

## 6. 実行コマンド

```bash
# タイムゾーンテスト実行
pytest tests/test_timezone_utils.py -v
```
