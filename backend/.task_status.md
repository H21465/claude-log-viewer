# Task: CLI時刻表示のローカルタイムゾーン対応

## 現在のフェーズ
Phase 5: REFACTOR - 完了

## 進捗
| Phase | Agent | Status | 成果物 |
|-------|-------|--------|--------|
| 1. 設計 | architect | ✅ | .task_status.md |
| 2. テスト設計 | test-designer | ✅ | test_design/test_design_timezone.md |
| 3. RED | test-writer | ✅ | tests/test_timezone_utils.py |
| 4. GREEN | implementer | ✅ | services/timezone_utils.py, cli.py |
| 5. REFACTOR | reviewer | ✅ | - |

## 要件分析

### 問題
- CLIに表示される時刻がUTCのまま表示されている
- `UsageEntry.timestamp` はUTCで保存されている
- ユーザーのローカルタイムゾーンに変換して表示する必要がある

### 影響箇所
1. `cli.py:199` - API Requestsテーブルの時刻表示 (`entry.timestamp.strftime`)
2. `cli.py:272` - フッターの最終更新時刻 (`datetime.now()`)

### 解決方針
1. **ユーティリティ関数を作成**: UTCからローカルタイムゾーンへの変換
2. **CLIの時刻表示を修正**: 変換関数を使用してローカル時刻を表示

### 技術設計

#### 変換ユーティリティ
```python
from datetime import datetime, timezone

def utc_to_local(utc_dt: datetime) -> datetime:
    """Convert UTC datetime to local timezone."""
    if utc_dt.tzinfo is None:
        # Assume naive datetime is UTC
        utc_dt = utc_dt.replace(tzinfo=timezone.utc)
    return utc_dt.astimezone()  # Converts to local timezone
```

#### 修正箇所
- `StatusEntry.timestamp` の表示時にローカル変換
- フッターの時刻は `datetime.now()` で既にローカル

### エッジケース
1. **タイムゾーン情報なしのdatetime**: UTCとして扱う
2. **既にローカルタイムゾーンのdatetime**: そのまま返す
3. **夏時間(DST)**: システムのタイムゾーン設定に従う

## 次フェーズへの引継ぎ
- `utc_to_local()` 関数のテストを設計
- CLIの時刻表示が正しく変換されることを確認
